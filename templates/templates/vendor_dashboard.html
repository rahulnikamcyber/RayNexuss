{% extends "base.html" %}

{% block title %}Vendor Dashboard{% endblock %}

{% block nav %}
<a href="/vendor/dashboard" class="hover:underline">Dashboard</a>
<a href="/logout" class="hover:underline">Logout</a>
{% endblock %}

{% block content %}
<div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Welcome, {{ vendor.company_name }}</h1>
    <p class="text-gray-600 mt-2">Vendor ID: {{ vendor.vendor_id }}</p>
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-white rounded-lg shadow p-6">
        <div class="text-sm text-gray-600 mb-2">Remaining Credits</div>
        <div class="text-3xl font-bold text-blue-600">{{ vendor.credits }}</div>
        {% if vendor.credits == 0 %}
        <a href="#" class="text-sm text-red-600 hover:underline mt-2 inline-block">Buy More Credits</a>
        {% endif %}
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
        <div class="text-sm text-gray-600 mb-2">Leads Today</div>
        <div class="text-3xl font-bold text-green-600">{{ leads_today }}</div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
        <div class="text-sm text-gray-600 mb-2">Total Leads Received</div>
        <div class="text-3xl font-bold text-purple-600">{{ assignments|length }}</div>
    </div>
</div>

<!-- Account Status -->
<div class="bg-white rounded-lg shadow p-6 mb-8">
    <h2 class="text-xl font-bold mb-4">Account Status</h2>
    <div class="grid grid-cols-2 gap-4">
        <div>
            <span class="text-gray-600">Status:</span>
            {% if vendor.is_active %}
            <span class="ml-2 px-3 py-1 text-sm rounded bg-green-100 text-green-800">Active</span>
            {% else %}
            <span class="ml-2 px-3 py-1 text-sm rounded bg-red-100 text-red-800">Inactive - No Credits</span>
            {% endif %}
        </div>
        <div>
            <span class="text-gray-600">City:</span>
            <span class="ml-2 font-semibold">{{ vendor.city }}</span>
        </div>
        <div>
            <span class="text-gray-600">Service:</span>
            <span class="ml-2 font-semibold">{{ vendor.service_type }}</span>
        </div>
        <div>
            <span class="text-gray-600">Mobile:</span>
            <span class="ml-2 font-semibold">{{ vendor.mobile }}</span>
        </div>
    </div>
</div>

<!-- Leads Received -->
<div class="bg-white rounded-lg shadow">
    <div class="p-6 border-b">
        <h2 class="text-xl font-bold">Your Leads</h2>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Lead #</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Mobile</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">City</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Budget</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Notes</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">WhatsApp</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Received</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for assignment in assignments %}
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 text-sm font-bold">#{{ "%03d"|format(assignment.vendor_lead_number) }}</td>
                    <td class="px-6 py-4 text-sm">{{ assignment.lead.full_name }}</td>
                    <td class="px-6 py-4 text-sm font-mono">{{ assignment.lead.mobile }}</td>
                    <td class="px-6 py-4 text-sm">{{ assignment.lead.city }}</td>
                    <td class="px-6 py-4 text-sm font-semibold">₹{{ "%.2f"|format(assignment.lead.budget) }}</td>
                    <td class="px-6 py-4 text-sm text-gray-600">{{ assignment.lead.notes[:50] }}...</td>
                    <td class="px-6 py-4 text-sm">
                        {% if assignment.whatsapp_sent %}
                        <span class="text-green-600">✓ Sent</span>
                        {% else %}
                        <span class="text-gray-400">✗ Not Sent</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-sm">{{ assignment.assigned_at.strftime('%Y-%m-%d %H:%M') }}</td>
                </tr>
                {% endfor %}
                
                {% if not assignments %}
                <tr>
                    <td colspan="8" class="px-6 py-8 text-center text-gray-500">
                        No leads received yet. Make sure you have credits and your account is active.
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Payment Section -->
<div class="mt-8 bg-blue-50 border-l-4 border-blue-500 p-6 rounded">
    <h3 class="text-lg font-bold text-blue-900 mb-2">Need More Credits?</h3>
    <p class="text-blue-800 mb-4">Purchase lead credits to continue receiving customer inquiries.</p>
    <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
        Buy Credits Now
    </button>
</div>
{% endblock %}
